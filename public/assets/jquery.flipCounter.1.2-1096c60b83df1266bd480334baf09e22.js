/*
 * jQuery Flip Counter v1.2 by Brolly.ca - http://bloggingsquared.com/jquery/flipcounter/
 *
 * Uses valid markup and an image sprite to render an analogue clock / odometer effect.
 * Clock image is easily customizable, default options can be easily overriden, can be easily animated and extended with jQuery.easing plugin, gracefully degrades if Javascript is not available.
 *
 * TERMS OF USE - jQuery Flip Counter
 * 
 * Open source under the BSD License. 
 * 
 * Copyright (C) 2010 Dan Imbrogno and Brolly Inc. 
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *	COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *	EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *	GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *	NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
 */
(function(a){a.fn.flipCounter=function(b){function f(){var a=c.data("flipCounter");return typeof a=="undefined"?!1:!0}function g(a){var b=c.data("flipCounter"),d=b[a];return typeof d!="undefined"?d:!1}function h(a,b){var d=c.data("flipCounter");d[a]=b,c.data("flipCounter",d)}function j(){c.children('[name="'+g("counterFieldName")+'"]').length<1&&c.append('<input type="hidden" name="'+g("counterFieldName")+'" value="'+g("number")+'" />');var b=m(),d=p().length;if(d>b)for(i=0;i<d-b;i++){var e=a('<span class="'+g("digitClass")+'" style="'+q("0")+'" />');c.prepend(e)}else if(d<b)for(i=0;i<b-d;i++)c.children("."+g("digitClass")).first().remove();c.find("."+g("digitClass")).each(function(){0==a(this).find("span").length&&a(this).append('<span style="visibility:hidden">0</span>')})}function k(){j();var b=p(),c=l(),d=0;a.each(c,function(c,e){digit=b.toString().charAt(d),a(this).attr("style",q(digit)),a(this).find("span").text(digit.replace(" ","&nbsp;").toString()),d++}),o()}function l(){return c.children("."+g("digitClass"))}function m(){return l().length}function n(){var a=parseFloat(c.children('[name="'+g("counterFieldName")+'"]').val());return a==a==0?!1:a}function o(){c.children('[name="'+g("counterFieldName")+'"]').val(g("number"))}function p(){var b=g("number");if(typeof b!="number")return a.error("Attempting to render non-numeric value."),"0";var c="";if(g("formatNumberOptions"))a.formatNumber?c=a.formatNumber(b,g("formatNumberOptions")):a.error("The numberformatter jQuery plugin is not loaded. This plugin is required to use the formatNumberOptions setting.");else if(b>=0){var d=g("numIntegralDigits"),e=d-b.toFixed().toString().length;for(var f=0;f<e;f++)c+="0";c+=b.toFixed(g("numFractionalDigits"))}else c="-"+Math.abs(b.toFixed(g("numFractionalDigits")));return c}function q(a){var b="height:"+g("digitHeight")+"px; width:"+g("digitWidth")+"px; display:inline-block; background-image:url('"+g("imagePath")+"'); background-repeat:no-repeat; ",c=new Array;return c[1]=g("digitWidth")*0,c[2]=g("digitWidth")*-1,c[3]=g("digitWidth")*-2,c[4]=g("digitWidth")*-3,c[5]=g("digitWidth")*-4,c[6]=g("digitWidth")*-5,c[7]=g("digitWidth")*-6,c[8]=g("digitWidth")*-7,c[9]=g("digitWidth")*-8,c[0]=g("digitWidth")*-9,c["."]=g("digitWidth")*-10,c["-"]=g("digitWidth")*-11,c[","]=g("digitWidth")*-12,c[" "]=g("digitWidth")*-13,a in c?b+"background-position: "+c[a]+"px 0px;":b}function r(b){1==g("animating")&&t(),typeof b!="undefined"?(b=a.extend(c.data("flipCounter"),b),c.data("flipCounter",b)):b=c.data("flipCounter"),0==g("start_time")&&h("start_time",(new Date).getTime()),0==g("time")&&h("time",0),0==g("elapsed")&&h("elapsed","0.0"),0==g("start_number")&&(h("start_number",g("number")),0==g("start_number")&&h("start_number",0)),s();var d=g("onAnimationStarted");typeof d=="function"&&d.call(c,c)}function s(){function l(){b+=10,d=Math.floor(b/10)/10,Math.round(d)==d&&(d+=".0"),h("elapsed",d);var g=(new Date).getTime()-a-b,m=0;typeof j=="function"?m=j.apply(c,[!1,b,e,f,i]):m=w(!1,b,e,f,i),h("number",m),h("time",b),k(),b<i?h("interval",window.setTimeout(l,10-g)):t()}var a=g("start_time"),b=g("time"),d=g("elapsed"),e=g("start_number"),f=g("end_number")-g("start_number");if(f==0)return!1;var i=g("duration"),j=g("easing");h("animating",!0),window.setTimeout(l,10)}function t(){if(0==g("animating"))return!1;clearTimeout(g("interval")),h("start_time",!1),h("start_number",!1),h("end_number",!1),h("time",0),h("animating",!1),h("paused",!1);var a=g("onAnimationStopped");typeof a=="function"&&a.call(c,c)}function u(){if(0==g("animating")||1==g("paused"))return!1;clearTimeout(g("interval")),h("paused",!0);var a=g("onAnimationPaused");typeof a=="function"&&a.call(c,c)}function v(){if(0==g("animating")||0==g("paused"))return!1;h("paused",!1),s();var a=g("onAnimationResumed");typeof a=="function"&&a.call(c,c)}function w(a,b,c,d,e){return b/e*d+c}var c=!1,d={number:0,numIntegralDigits:1,numFractionalDigits:0,digitClass:"counter-digit",counterFieldName:"counter-value",digitHeight:40,digitWidth:30,imagePath:"/assets/flipCounter-medium.png",easing:!1,duration:1e4,onAnimationStarted:!1,onAnimationStopped:!1,onAnimationPaused:!1,onAnimationResumed:!1,formatNumberOptions:!1},e={init:function(b){return this.each(function(){c=a(this);var e=a.extend(d,b),f=c.data("flipCounter");b=a.extend(f,e),c.data("flipCounter",b);if(b.number===!1||b.number==0)n()!==!1?b.number=n():b.number=0,h("number",b.number);h("animating",!1),h("start_time",!1),c.bind("startAnimation",function(a,b){r(b)}),c.bind("pauseAnimation",function(a){u()}),c.bind("resumeAnimation",function(a){v()}),c.bind("stopAnimation",function(a){t()}),c.htmlClean(),k()})},renderCounter:function(b){return this.each(function(){c=a(this),f()||a(this).flipCounter(),h("number",b),k()})},setNumber:function(b){return this.each(function(){c=a(this),f()||a(this).flipCounter(),h("number",b),k()})},getNumber:function(){var b=!1;return this.each(b=function(){return c=a(this),f()||a(this).flipCounter(),b=g("number"),b}),b},startAnimation:function(b){return this.each(function(){c=a(this),f()||a(this).flipCounter(),c.trigger("startAnimation",b)})},stopAnimation:function(){return this.each(function(){c=a(this),f()||a(this).flipCounter(),c.trigger("stopAnimation")})},pauseAnimation:function(){return this.each(function(){c=a(this),f()||a(this).flipCounter(),c.trigger("pauseAnimation")})},resumeAnimation:function(){return this.each(function(){c=a(this),f()||a(this).flipCounter(),c.trigger("resumeAnimation")})}};if(e[b])return e[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return e.init.apply(this,arguments);a.error("Method "+b+" does not exist on jQuery.flipCounter")}})(jQuery),jQuery.fn.htmlClean=function(){this.contents().filter(function(){return this.nodeType!=3?($(this).htmlClean(),!1):!/\S/.test(this.nodeValue)}).remove()};