function buildPrivatePub(doc){var self={connecting:!1,fayeClient:null,fayeCallbacks:[],subscriptions:{},subscriptionCallbacks:{},faye:function(a){if(self.fayeClient)a(self.fayeClient);else{self.fayeCallbacks.push(a);if(self.subscriptions.server&&!self.connecting){self.connecting=!0;var b=doc.createElement("script");b.type="text/javascript",b.src=self.subscriptions.server+".js",b.onload=self.connectToFaye,doc.documentElement.appendChild(b)}}},connectToFaye:function(){self.fayeClient=new Faye.Client(self.subscriptions.server),self.fayeClient.addExtension(self.fayeExtension);for(var a=0;a<self.fayeCallbacks.length;a++)self.fayeCallbacks[a](self.fayeClient)},fayeExtension:{outgoing:function(a,b){if(a.channel=="/meta/subscribe"){var c=self.subscriptions[a.subscription];a.ext||(a.ext={}),a.ext.private_pub_signature=c.signature,a.ext.private_pub_timestamp=c.timestamp}b(a)}},sign:function(a){self.subscriptions.server||(self.subscriptions.server=a.server),self.subscriptions[a.channel]=a,self.faye(function(b){b.subscribe(a.channel,self.handleResponse)})},handleResponse:function(message){message.eval&&eval(message.eval),(callback=self.subscriptionCallbacks[message.channel])&&callback(message.data,message.channel)},subscribe:function(a,b){self.subscriptionCallbacks[a]=b}};return self}var PrivatePub=buildPrivatePub(document);